/*! -- File: jquery.matchingQuestion.js ( Input 0 ) -- */
!function(c){var e=function(a,b){this.options=b;this.$el=c(a);this.categories={};this.items={};this.dotSize=30;this.inReview=!1;this.initDB(b.outline,this.onDBElementRegistered.bind(this));this.started=!1;this.tried=[];this.tries=0;this.onWindowResize=DKI.func.debounce(c.proxy(this.setHeight,this),50,!1);this.initSubscribers();this.initInteractions();this.initWidgets();this.options.accessible&&(this.accessibility=new e.Accessibility(this));this.setupAfterImageLoad();return this};e.DEFAULTS={accessible:!0,
responsive:!1,strings:{scoreLabel:"Score:",retryLabel:"Retry"},outline:{},retries:0,enableDraggable:!0};e.constant=Object.freeze({screenReader:{visible:function(a){var b={"aria-hidden":!1};a&&(b.tabindex=1);return b},hidden:function(){return{tabindex:"-1","aria-hidden":"true"}}}});e.prototype={initDB:function(a,b){this.db=function(){var a={},b={dragdrop_id:{},category_items:{}};return{store:function(d){a[d.id]=d;b.dragdrop_id[d.dragdrop_id]=a[d.id];if("matchingQuestionItem"===d.elementtype)for(var c=
0;c<d.parameters.config.link.length;c++)b.category_items[d.parameters.config.link[c]]||(b.category_items[d.parameters.config.link[c]]=[]),b.category_items[d.parameters.config.link[c]].push(d.dragdrop_id)},get:function(b){return a[b]},getByKey:function(a,d){return b[a][d]},remove:function(b){delete a[item.id]},clear:function(){a={}},getLength:function(){return Object.keys(a).length}}}();var d=c.proxy(function(a){this.db.store(a);b(a);for(var c in a.elements)d(a.elements[c])},this);d(a)},start:function(){this.accessibility&&
this.accessibility.start()},initSubscribers:function(){var a=this;this.$el.on("click",".categories .category",function(){a.inReview||a.toggleCategoryActiveForCurrentItem(c(this))})},initInteractions:function(){var a=this;c(window).on("resize",function(){a.options.enableDraggable&&c(".card_container .card",a.$el).draggable("option","containment",DKI.utility.getDragContainment(a.$el,a.dotSize,a.dotSize))});"undefined"!=typeof DKI&&"undefined"!=typeof DKI.ContentPage&&"undefined"!=typeof DKI.ContentPage.events&&
(c(document).on(DKI.ContentPage.events.started,function(){setTimeout(function(){c(".card_container .card",a.$el).draggable("option","containment",DKI.utility.getDragContainment(a.$el,a.dotSize,a.dotSize))},20)}),c(document).on(DKI.ContentPage.events.shown,function(){setTimeout(function(){c(".card_container .card",a.$el).draggable("option","containment",DKI.utility.getDragContainment(a.$el,a.dotSize,a.dotSize))},20)}),c(document).on(DKI.ContentPage.events.hidden,function(){setTimeout(function(){c(".card_container .card",
a.$el).draggable("option","containment",DKI.utility.getDragContainment(a.$el,a.dotSize,a.dotSize))},20)}),c(document).on(DKI.ContentPage.events.questionElementFeedbackShown,function(){setTimeout(function(){c(".card_container .card",a.$el).draggable("option","containment",DKI.utility.getDragContainment(a.$el,a.dotSize,a.dotSize))},20)}));c(".card_container .card",this.$el).draggable({helper:function(b,d,f,g){return c(this).find(".item_num").clone().appendTo(a.$el).css("margin","0")},revert:"invalid",
revertDuration:0,containment:DKI.utility.getDragContainment(a.$el,a.dotSize,a.dotSize),stack:a.$el,scroll:"undefined"!=typeof settings?settings.responsive:c("html").hasClass("responsive"),zIndex:1E5,disabled:!1,start:function(b,d,f){c(".categories .category",a.$el).droppable("enable")},drag:function(a,d){DKI.utility.dragFix(d)},stop:function(b,d){d.helper.remove();c(".categories .category",a.$el).droppable("disable")},cursorAt:{left:a.dotSize/2,top:a.dotSize/2}});c(".categories .category",this.$el).droppable({accept:".card, .category_item",
disabled:!0,tolerance:"pointer",out:function(a,d){c(this).removeClass("drag-over")},over:function(a,d){c(this).addClass("drag-over")},drop:function(b,d){if(!a.inReview){var f=this;b=a.getCurrentSelectedItemElement().dragdrop_id;b=c('.category_item[data-id\x3d"'+b+'"]:not(.ui-draggable-dragging)',f);if(b.hasClass("selected"))return d.helper.remove(),!1;var g=d.helper.clone().appendTo(a.$el);b=b.offset();var e=g.offset(),h=g.position();b={top:h.top+(b.top-e.top),left:h.left+(b.left-e.left)};e=settings.scale;
!settings.responsive&&d.helper.closest(".fancybox-container").length&&(e*=settings.claroLightboxScaling);b.top/=e;b.left/=e;g.velocity(b,{duration:500,complete:function(){d.helper.remove();g.remove();c(f).removeClass("drag-over");a.toggleCategoryActiveForCurrentItem(c(f))}})}}})},initWidgets:function(){var a=this,b=this.$el.find(".items_carousel");b.flickity({accessibility:!0,cellAlign:"center",draggable:!1});b.attr("tabindex",1);var d=b.data("flickity");b.on("select.flickity",function(b){b=c(d.selectedCell.element).find(".card");
a.$el.find(".category_item.current").removeClass("current").draggable("disable");a.$el.find(".category_item[data-id\x3d"+b.data("dragdropid")+"]").addClass("current");a.$el.find(".category_item[data-id\x3d"+b.data("dragdropid")+"].selected").draggable("enable")});b.flickity("selectCell",0,!1,!0)},setupAfterImageLoad:function(){var a=this.$el.find("img"),b=a.length,d=this,f=function(){--b;if(0>=b)d.onImagesLoaded()};if(0===a.length)d.onImagesLoaded();else a.each(function(){if(c(this).prop("complete"))f();
else c(this).on("load",f)})},onDBElementRegistered:function(a){"matchingQuestionCategory"===a.elementtype?this.createCategory(a):"matchingQuestionItem"===a.elementtype&&(this.items[a.id]=a)},createCategory:function(a){this.categories[a.id]=new e.Category(this,a);return this.categories[a.id]},onImagesLoaded:function(){this.$el.css("opacity",1);this.$el.trigger(e.Events.onReady);this.start()},toggleCategoryActiveForCurrentItem:function(a){(a=this.categories[a.data("id")])&&a.toggleItemById(this.getCurrentSelectedItemElement().dragdrop_id)},
runScoring:function(a,b){return this.getPass(a,b)},getGivenAnswers:function(){var a=this;return Object.keys(this.categories).reduce(function(b,d){d=a.categories[d];b[d.outline.dragdrop_id]=d.getSelectedItems();return b},{})},getItemScore:function(a,b){b=b||this.getGivenAnswers();var d=a.parameters.config.link,f=0,e=0;c.each(b,function(b,c){~c.indexOf(a.dragdrop_id)&&(f+=1,~d.indexOf(b)&&(e+=1))});f=Math.max(d.length,f);return 0==f?100:e/f*100||0},score:function(){var a=this,b=this.getGivenAnswers(),
d=0,f=Object.keys(this.items).length;c.each(this.items,function(c,f){d+=a.getItemScore(f,b)});return Math.floor(d/f)||0},fireResult:function(a){this.$el.trigger(MatchingQuestionEvents.onAttempt);(100===a||this.tries>=this.options.retries)&&this.$el.trigger(MatchingQuestionEvents.onSubmitted);if(100===a)this.$el.trigger(MatchingQuestionEvents.onCorrect);else{var b="on";this.tries<this.options.retries&&(b+="Attempt");this.$el.trigger(MatchingQuestionEvents[b+(0===a?"Incorrect":"PartialCorrect")])}},
getxAPICompleteData:function(){for(var a=this.getGivenAnswers(),b=Object.keys(a),d=[],c=0;c<b.length;c++)for(var e=a[b[c]],k=this.db.getByKey("dragdrop_id",b[c]),h=0;h<e.length;h++){var l=this.db.getByKey("dragdrop_id",e[h]);d.push(k.id+"[.]"+l.id)}return{givenAnswersRaw:a,givenAnswerPattern:d.join("[,]"),sources:this.items,targets:this.categories}},getCarouselEl:function(){return this.$el.find(".items_carousel")},getCurrentSelectedItemElement:function(){return this.db.get(c(this.getCarouselEl().data("flickity").selectedElement).find(".card").data("id"))},
hasSelection:function(){for(var a=Object.keys(this.categories),b=0;b<a.length;b++)if(0<this.categories[a[b]].getSelectedItems().length)return!0;return!1},enterReview:function(a){var b=this,d=this.getGivenAnswers();this.inReview=!0;c.each(this.items,function(a,c){a=b.getItemScore(c,d);b.$el.find('.items .card[data-id\x3d"'+c.id+'"] .item_num').addClass(100===a?"selected correct":"selected incorrect")});c.each(this.categories,function(b,c){c.showFeedback(a)});b.$el.addClass("inReview");c(".ui-draggable",
this.$el).draggable("disable")},exitReview:function(){this.inReview=!1;this.$el.find(".items .card .item_num").removeClass("selected correct incorrect");c.each(this.categories,function(a,b){b.hideFeedback()});this.$el.removeClass("inReview");c(".card_container .card",this.$el).draggable("enable")},resetUI:function(){this.passed=0;this.tried=[];this.exitReview();this.start()},hasInlineFeedback:function(){return!0},showInlineFeedback:function(a){return this.enterReview(a)},import:function(a){var b=
this;c.each(a.categories,function(a,c){b.categories[a]&&b.categories[a].import(c)})},export:function(){var a=this;return{categories:Object.keys(this.categories).reduce(function(b,c){b[c]=a.categories[c].export();return b},{})}},reset:function(){var a=this.export().categories,b;for(b in a){var c=this.categories[b];c&&(c.hideFeedback(),a[b].selected.forEach(function(a){c.toggleItemById(a,!1)}))}this.$el.find(".items .card .item_num").removeClass("selected correct incorrect");this.getCarouselEl().data("flickity").select(0);
this.resetUI();this.tries=0},destroy:function(){c(window).off("resize",this.onWindowResize);this.categories={};this.items={}}};c.fn.MatchingQuestion=function(a){var b=a,d=Array.prototype.slice.call(arguments,1);return this.each(function(){var f=c(this),g=c(this).data("dki.MatchingQuestion"),k=c.extend(!0,{},e.DEFAULTS,"object"===typeof b&&b);if("string"===typeof a&&!g)return!1;g?"string"===typeof a&&(f=c(this).data("dki.MatchingQuestion"))&&f[a]&&f[a].apply(c(this).data("dki.MatchingQuestion"),d):
f.data("dki.MatchingQuestion",new e(this,k))})};c.fn.MatchingQuestion.Constructor=e;e.Events={onReady:"matchingQuestionReady"};e.Category=function(a,b){var d=this;this.dotSize=30;this.outline=b;this.matchingQuestion=a;this.$el=this.matchingQuestion.$el.find('.category[data-id\x3d"'+b.id+'"]');c(window).on("resize",function(){d.matchingQuestion.options.enableDraggable&&c(".category_item",d.$el).draggable("option","containment",DKI.utility.getDragContainment(d.matchingQuestion.$el,d.dotSize,d.dotSize))});
c(".category_item",this.$el).draggable({containment:DKI.utility.getDragContainment(d.matchingQuestion.$el,d.dotSize,d.dotSize),zIndex:1E5,disabled:!0,helper:function(a,b,e,h){return c(this).clone().css("margin","0").appendTo(d.matchingQuestion.$el)},start:function(a,b){c(".categories .category",d.matchingQuestion.$el).droppable("enable");c(this).removeClass("selected")},drag:function(a,b){DKI.utility.dragFix(b)},stop:function(a,b){c(".categories .category",d.matchingQuestion.$el).droppable("disable")}});
return this};e.Category.prototype={toggleItemById:function(a,b){a=this.$el.find('.category_item[data-id\x3d"'+a+'"]');(b="undefined"!==typeof b?b:!a.hasClass("selected"))?(a.addClass("selected"),a.draggable("enable"),a.draggable("option","containment",DKI.utility.getDragContainment(this.matchingQuestion.$el,this.dotSize,this.dotSize))):(a.removeClass("selected"),a.draggable("disable"));this.matchingQuestion.accessibility&&this.matchingQuestion.accessibility.setVisibility(a,b)},getSelectedItems:function(){return this.$el.find(".category_item.selected").toArray().reduce(function(a,
b){a.push(c(b).data("id"));return a},[])},showFeedback:function(a){var b=this.matchingQuestion.db.getByKey("category_items",this.outline.dragdrop_id)||[];this.$el.find(".category_item").each(function(){var d=c(this).data("id"),f=c(this).hasClass("selected");~b.indexOf(d)?(f||a)&&c(this).addClass("correct"):f&&c(this).addClass("incorrect")})},hideFeedback:function(){this.$el.find(".category_item").removeClass("correct incorrect")},export:function(){return{selected:this.getSelectedItems()}},import:function(a){for(var b=
0;b<a.selected.length;b++)this.toggleItemById(a.selected[b],!0)}};e.Accessibility=function(a){this.categoryCards=a;this.$el=a.$el;return this};e.Accessibility.prototype={start:function(){var a=this.$el.find(".items_carousel"),b=a.data("flickity"),d=this;a.attr("role","application");a.find(".flickity-prev-next-button").attr(e.constant.screenReader.hidden());a.find(".card").first().find(".content").attr(e.constant.screenReader.visible(!0));a.on("select.flickity",function(a){a=b.selectedCell.element;
c(this).find(".card .content[tabindex\x3d'1']").attr(e.constant.screenReader.hidden());c(a).find(".content").attr(e.constant.screenReader.visible(!0))});a.on("settle.flickity",function(){var a=b.selectedCell.element;a&&c(a).find(".content")[0].focus()});a.on("keydown",function(a){if(37==a.which||39==a.which)return c(this).flickity(37==a.which?"previous":"next"),!1;if(13===a.which)return a=d.$el.find(".categories .category").first(),a[0]&&a[0].focus(),!1})},setVisibility:function(a,b){a.attr(e.constant.screenReader[b?
"visible":"hidden"]())}}}(window.jQuery);var MatchingQuestionEvents={onSubmitted:"matchingQuestionSubmitted",onCorrect:"matchingQuestionCorrect",onIncorrect:"matchingQuestionIncorrect",onPartialCorrect:"matchingQuestionPartialCorrect",onAttempt:"matchingQuestionAttempt",onAttemptIncorrect:"matchingQuestionAttemptIncorrect",onAttemptPartialCorrect:"matchingQuestionAttemptPartialCorrect"};